<div class="nav-container">
    <div class='nav-logo-box'>
        <%= link_to dashboard_path do %>
            <%= image_tag 'JIMS-Logo.png', class: "nav-logo", alt:"JIMS" %>
        <% end %>
    </div>
    <div class="nav-link-container">
        <% if current_user&.has_permission?('view_dashboard') %>
            <%= link_to 'Dashboard', dashboard_path, class: "nav-link #{'active' if current_page?(dashboard_path)}" %>
        <% end %>
        <% if current_user&.has_permission?('view_admin') %>
            <div class="nav-dropdown">
                <% if current_user&.has_permission?('view_dashboard') %>
                    <div class="nav-drop-button nav-link">Admin <span class="nav-drop-icon">â–¼</span></div>
                    <% admin_active = current_page?(admin_users_path) || current_page?(admin_roles_path) %>
                    <div class="nav-dropdown-content <%= 'open' if admin_active %>">
                        <%= link_to 'Users', admin_users_path, class: "nav-dropdown-item nav-link #{'active' if current_page?(admin_users_path)}"  %>
                        <%= link_to 'Roles', admin_roles_path, class: "nav-dropdown-item nav-link #{'active' if current_page?(admin_roles_path)}"  %>
                    </div>
                <% end %>
            </div>
        <% end %>
        <% if current_user&.has_permission?('view_inventory') %>
            <%= link_to 'Inventory', inventories_path, class: "nav-link #{'active' if current_page?(inventories_path)}" %>
        <% end %>
        <%= form_with url: logout_path, method: :delete, local: true, class: "inline-form" do %>
            <%= submit_tag "Logout", class: "logout-link nav-link", data: { disable_with: "Logging out..." } %>
        <% end %>
    </div>
</div>

<script>
document.addEventListener("turbo:load", () => {
  const dropbtn = document.querySelector('.nav-drop-button');
  if (dropbtn) {
    dropbtn.addEventListener('click', (e) => {
      e.preventDefault();
      const dropdown = dropbtn.nextElementSibling;
      dropdown.classList.toggle('open');
    });

    document.addEventListener('click', (e) => {
      const dropdown = dropbtn.nextElementSibling;
      if (!dropbtn.contains(e.target) && !dropdown.contains(e.target)) {
        dropdown.classList.remove('open');
      }
    });
  }
});

</script>