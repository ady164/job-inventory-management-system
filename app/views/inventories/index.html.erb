<div class="main-content">
  <H1>INVENTORIES</H1>
  <div class="listing-header">
    <input type="text" id="inventorySearch" onkeyup="searchTable()" placeholder="Search inventory..." class="search-input">
    <%= link_to 'Add New Inventory', new_inventory_path, class: 'btn-save' %>
  </div>
  <table class="listing-table" id="sortTable" data-sort-col="-1" data-sort-order="">
    <thead>
      <tr>
        <th onclick="sortTable(0)">ID <span class="sort-indicator"></span></th>
        <th>Image</th>
        <th onclick="sortTable(2)">Name <span class="sort-indicator"></span></th>
        <th onclick="sortTable(3)">Product No. <span class="sort-indicator"></span></th>
        <th onclick="sortTable(4)">Brand <span class="sort-indicator"></span></th>
        <th onclick="sortTable(5)">Category <span class="sort-indicator"></span></th>
        <th onclick="sortTable(6)">Quantity <span class="sort-indicator"></span></th>
        <th onclick="sortTable(7)">Alert Qty <span class="sort-indicator"></span></th>
        <th onclick="sortTable(8)">Status <span class="sort-indicator"></span></th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @inventories.each do |item| %>
        <tr>
          <td><%= item.id %></td>
          <td><%= image_tag "#{item.image_path}", alt: 'Image', class: 'thumb' %></td>
          <td><%= item.name %></td>
          <td><%= item.product_number %></td>
          <td><%= item.brand %></td>
          <td><%= item.category %></td>
          <td><%= item.quantity %></td>
          <td><%= item.alert_quantity %></td>
          <td><%= item.status %></td>
          <td>
            <%= link_to 'Edit', edit_inventory_path(item), class: 'btn-edit' %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<!-- 🧾 CSS for search input and sort indicators -->
<style>
  .search-input {
    margin-bottom: 10px;
    padding: 8px;
    width: 300px;
    font-size: 16px;
  }

  th {
    cursor: pointer;
    user-select: none;
  }

  .sort-indicator {
    margin-left: 5px;
    font-size: 12px;
  }
</style>

<!-- 🔃 Sorting Script with visual indicator -->
<script>
  function sortTable(columnIndex) {
    const table = document.getElementById("sortTable");
    const rows = Array.from(table.rows).slice(1);
    const headers = table.querySelectorAll("th .sort-indicator");

    let isNumeric = !isNaN(rows[0].cells[columnIndex].innerText.trim());
    let ascending = !(table.dataset.sortCol == columnIndex && table.dataset.sortOrder === "asc");

    // Sort rows
    rows.sort((a, b) => {
      let aText = a.cells[columnIndex].innerText.trim();
      let bText = b.cells[columnIndex].innerText.trim();

      if (isNumeric) {
        return ascending ? aText - bText : bText - aText;
      } else {
        return ascending
          ? aText.localeCompare(bText)
          : bText.localeCompare(aText);
      }
    });

    // Append sorted rows
    rows.forEach(row => table.tBodies[0].appendChild(row));

    // Update sort indicators
    headers.forEach(span => span.textContent = ""); // Clear all
    const currentHeader = table.rows[0].cells[columnIndex].querySelector(".sort-indicator");
    currentHeader.textContent = ascending ? "▲" : "▼";

    // Save state
    table.dataset.sortCol = columnIndex;
    table.dataset.sortOrder = ascending ? "asc" : "desc";
  }
</script>

<!-- 🔍 Search Script -->
<script>
  function searchTable() {
    const input = document.getElementById("inventorySearch");
    const filter = input.value.toLowerCase();
    const table = document.getElementById("sortTable");
    const rows = table.getElementsByTagName("tr");

    for (let i = 1; i < rows.length; i++) {
      let cells = rows[i].getElementsByTagName("td");
      let match = false;

      for (let j = 0; j < cells.length; j++) {
        let cellText = cells[j].innerText.toLowerCase();
        if (cellText.includes(filter)) {
          match = true;
          break;
        }
      }

      rows[i].style.display = match ? "" : "none";
    }
  }
</script>
